## Практическое задание. Смена пароля учётной записи при доступе к ОС LINUX.

Как объяснялось ранее, Linux и Windows имеют существенные отличия. Отличия касаются также и вопросов хранения различных системных данных, например, учётных записей пользователей. В Windows учётные записи хранятся в реестре или в файлах в бинарном виде. В Linux пошли другим путём - практически все сущности хранятся в текстовом виде. Более того, **все объекты в файловой системе являются файлами** - и флеш-накопители, и принтер, и каталог, и подключение к web-сайту, и ethernet-адаптер - всё это файлы особого вида. Для файла определены такие операции, как "open", "close", "read" и "write".


### Рассматриваемые вопросы
1. Что такое хэширование?
1. Изменение пароля учетной записи пользователя
1. Пользователи в Linux


### Термины которые нужно усвоить
* хэш-функции
* криптостойкие хэш-функции
* хэширование
* "соль" или "солёное" хэширование
* root
* /etc/shadow
* /etc/passwd
* cat


### Про хэширование пароля


Хеширование (иногда хэширование, англ. hashing) — преобразование входного массива данных произвольной длины в выходную битовую строку фиксированной длины. Такие преобразования также называются хеш-функциями или функциями свёртки, а их результаты называют хешем, хеш-кодом или дайджестом сообщения. 

Также все хэш-функции имеют такое свойство, что если входное значение изменяется даже совсем немного, полученный хеш-код полностью отличается от исходного.

Это отлично подходит для защиты паролей, потому что мы хотим сохранить пароли в зашифрованном виде, невозможном для расшифровки, и в то же время мы должны быть способны проверить то, что пароль пользователя корректен.



Общая схема процесса регистрации аккаунта и аутентификации в системе учетных записей, основанной на хешировании, выглядит следующим образом:


1. Пользователь создает учетную запись
1. Вычисляется хеш-код от пароля и сохраняется в базе данных. Нет никакого смысла в пароле, записанном в обычном текстовом (незашифрованном) формате на жесткий диск
1. Когда пользователь пытается войти в систему, хеш-код, вычисленный от пароля, который он ввел, сравнивается с хеш-кодом реального пароля 
1. Если хеш-коды совпадают, пользователю предоставляется доступ. Если нет – пользователю сообщается, что он ввел неверные данные для входа в учетную запись
1. Шаги 3 и 4 повторяются каждый раз, когда кто-либо пытается войти в свой аккаунт


На шаге 4 никогда не сообщайте пользователю, что именно не так: имя пользователя или пароль. Всегда отображайте только общее сообщение, например, «Неверное имя пользователя или пароль». Это не позволит злоумышленникам вычислить верные имена пользователей без знания их паролей.


Следует отметить, что хеш-функции, используемые для защиты паролей, это не те же хеш-функции, которые вы могли видеть на дисциплине ТИМП. Хеш-функции, используемые для реализации структур данных, таких как хеш-таблицы, разрабатываются для того, чтобы быть быстрыми, а не безопасными.


Только криптографические хеш-функции могут быть использованы для реализации хеширования паролей. Такие функции, как SHA256, SHA512, RipeMD и WHIRLPOOL являются криптографическими хеш-функциями.

Также стоит упомянуть о существование древнерусского божества, а именно нашу отечественную хэш-функцию Стрибо́г.


Если два пользователя имеют один и тот же пароль, у них будет совпадать и хеш-код пароля. Мы можем предотвратить эти атаки, внеся случайную составляющую в каждый хеш-код; таким образом, когда одинаковый пароль хешируется дважды, хеш-коды получаются разные.


Мы можем внести случайную составляющую в хеш-коды, добавив в конец или в начало пароля случайную строку, называемую «соль», перед операцией хеширования. При этом, как показано в примере ниже, всякий раз получаются совершенно разные строки из одного и того же хеш-кода пароля.



    ```bash
        hash("hello") = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824
        hash("hello" + "QxLUF1bgIAdeQX") = 9e209040c863f84a31e719795b2577523954739fe5ed3b58a75cff2127075ed1
        hash("hello" + "bv5PehSMfV11Cd") = d1d3ec2e6f20fd420d50e2642992841d8338a314b8ea157c9e18477aaef226ab
        hash("hello" + "YYLmfY6IehjZMQ") = a49670c3c18b9e079b9cfaf51634f563dc8ae3070db2c4a8544305df1b60f007
    ```

Чтобы проверить, корректен ли пароль, нам нужна соль, поэтому обычно ее сохраняют в базе данных пользовательских аккаунтов вместе с хеш-кодом, или как часть самой строки хеш-кода.


Соль не обязательно держать в секрете. Просто при использовании случайной величины для построения хеш-кода таблицы поиска, обратные таблицы поиска и радужные таблицы становятся неэффективными. Злоумышленник не узнает заранее, какая будет соль, поэтому он не может предварительно вычислить таблицу поиска или радужную таблицу.


Этот краткий экскурс о хэшировании паролей, должен помочь нам разобраться как всё-таки хранятся пароли в ОС LINUX.

### Хранение паролей в ОС LINUX
Linux хранит зашифрованные пароли пользователей,также как и другую информацию связанную с безопасностью, например сроки действия аккаунтов или паролей, в файле /etc/shadow.



Однажды у вас может возникнуть необходимость вручную отредактировать файл /etc/shadow для того, чтобы задать или изменить чей-то пароль.

В отличие от файла /etc/passwd, который могут читать все, файл /etc/shadow должен быть доступен для чтения ИСКЛЮЧИТЕЛЬНО пользователю ROOT.


1. Изменить пароль учетной записи
	* Посмотреть существующих в системе пользователей;cat /etc/passwd
	
	```bash
	 hash("hello") = 2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824
        hash("hello" + "QxLUF1bgIAdeQX") = 9e209040c863f84a31e719795b2577523954739fe5ed3b58a75cff2127075ed1
        hash("hello" + "bv5PehSMfV11Cd") = d1d3ec2e6f20fd420d50e2642992841d8338a314b8ea157c9e18477aaef226ab
        hash("hello" + "YYLmfY6IehjZMQ") = a49670c3c18b9e079b9cfaf51634f563dc8ae3070db2c4a8544305df1b60f007
	```
	* Каждая строка содержит имя пользователя, x вместо пароля (значит, пароль нужно искать в /etc/shadow), UID (unique identificator) пользователя, GID (group identificator) группы пользователя, путь к домашней директории пользователя, путь к терминалу по умолчанию (подробнее в ПЗ3). Посмотреть man passwd
	* Посмотреть UID, GID и группы пользователя можно командой **id**. Без параметра даёт информацию по текущему пользователя, для пользователя user нужно выполнить команду id user.
	* Посмотреть хэши паролей всех пользователей. **Сделать скриншот** хэша пароля того пользователя, для которого будет меняться пароль;
	
	```bash
	cat /etc/shadow
	```
	* Каждая строка содержит имя пользователя, xэш его пароля и ряд служебных значений вроде "даты окончания действия пароля".
	
	* Изменить пароль учётной записи user (для готовой виртуалки пользователя an) командой
	
    ```bash
    passwd user
    ```
	* Ввести новый пароль;
	* Повторно посмотреть /etc/shadow. **Сделать скриншот** хэша нового пароля. **Уяснить**, почему команда passwd не сработала при файловой системе в состоянии read only.
	* Перезагрузиться командой reboot (или reboot -f для варианта 1, когда reboot без параметров жалуется на отсутствие init) и зайти под пользователем user;





### Суперпользователь в Ubuntu

* Начнем с того, что суперпользователя в Ubuntu никто не отключал, пользователь root существует и от его имени работают процессы, как в других системах. Просто для этого пользователя не задан пароль. Поэтому вы и не можете войти. Но есть несколько способов авторизоваться от имени root без пароля.
       


Во-первых, это sudo.

* Команда su запрашивает пароль только в том случае, если вы выполняете ее от имени обычного пользователя. Если команда будет запущена от имени суперпользователя, то пароль спрашиваться не будет, а вы сразу перейдете в терминал root.


	

    ```bash
    sudo su
    ```

	

* Но есть и более простой и правильный вариант, вы можете использовать опцию -i утилиты sudo чтобы перейти в терминал суперпользователя:


    ```bash
    sudo -i
    ```


### Пароль от root

Несмотря на приведенные выше способы решения проблемы, вы все еще не можете авторизоваться от имени суперпользователя в TTY или использовать утилиту su без sudo. Если это для вас важно дальше мы рассмотрим как установить пароль root Ubuntu и вернуть полноценного root пользователя. Только это все нужно делать когда у вас есть обычный пользователь и доступ к нему.


* Сначала смотрим и убеждаемся, что пароль у root действительно есть, и запоминаем его хэш. Для этого вводим в терминале команды

    ```bash
    sudo cat /etc/shadow | grep root
    ```

* Затем устанавливаем новый пароль root, для этого наберите:


    ```bash
    sudo passwd root
    ```
* Теперь нужно ввести два раза пароль и готово. Проверяем, что при выполении предыдущей команды хэш изменился.


### Задание для самостоятельной работы
1. Познакомиться и иметь представление о таких хэш-функциях, как SHA256, SHA512, RipeMD и WHIRLPOOL.
2.Изучить понятие радужные таблицы, таблицы поиска и обратные таблицы поиска.
3. Познакомиться с утилитой fakeroot(  Возможно ли  повторить задание данного ПЗ из под fakeroot? )
    
   


    




